{"version":3,"sources":["../src/index.ts"],"sourcesContent":["// export enum VKYCErrorCode {\r\n//   PERMISSION_DENIED = \"PERMISSION_DENIED\",\r\n//   DEVICE_NOT_FOUND = \"DEVICE_NOT_FOUND\",\r\n//   NOT_SUPPORTED = \"NOT_SUPPORTED\",\r\n//   TIMEOUT = \"TIMEOUT\",\r\n//   NETWORK_ERROR = \"NETWORK_ERROR\",\r\n//   UNKNOWN_ERROR = \"UNKNOWN_ERROR\",\r\n// }\r\n\r\n// export enum VKYCPermissionStatus {\r\n//   ALLOWED = \"ALLOWED\",\r\n//   NOT_ALLOWED = \"NOT_ALLOWED\",\r\n//   BLOCKED = \"BLOCKED\"\r\n// }\r\n\r\n// export interface BaseVKYCResult {\r\n//   IS_PERMISSION_ALLOWED: VKYCPermissionStatus;\r\n//   ERROR_MESSAGE?: string;\r\n//   ERROR_CODE?: VKYCErrorCode;\r\n// }\r\n\r\n// // Camera + Video + Resolution\r\n// export interface VKYCCameraResult extends BaseVKYCResult {\r\n//   HAS_CAMERA: boolean;\r\n//   RESOLUTION_WIDTH?: number;\r\n//   RESOLUTION_HEIGHT?: number;\r\n// }\r\n\r\n// // Microphone\r\n// export interface VKYCMicResult extends BaseVKYCResult {\r\n//   HAS_MICROPHONE: boolean;\r\n// }\r\n\r\n// // Geolocation\r\n// export interface VKYCLocationResult extends BaseVKYCResult {\r\n//   LATITUDE: string;\r\n//   LONGITUDE: string;\r\n// }\r\n\r\n// // Network + Speed\r\n// export interface VKYCNetworkResult extends BaseVKYCResult {\r\n//   IS_ONLINE: boolean;\r\n//   DOWNLINK_MBPS?: number;          \r\n//   CONNECTION_TYPE?: string;\r\n//   RTT_MS?: number;\r\n//   DOWNLOAD_SPEED_MBPS?: number;    \r\n// }\r\n\r\n// export async function requestCameraAccess(): Promise<VKYCCameraResult> {\r\n//   return requestMedia({ video: true, audio: false });\r\n// }\r\n\r\n// export async function requestMicrophoneAccess(): Promise<VKYCMicResult> {\r\n//   return requestMedia({ video: false, audio: true });\r\n// }\r\n\r\n// export async function requestVideoAndMicAccess(): Promise<VKYCCameraResult & VKYCMicResult> {\r\n//   return requestMedia({ video: true, audio: true });\r\n// }\r\n\r\n// export async function requestLocationAccess(): Promise<VKYCLocationResult> {\r\n//   if (!navigator.geolocation) {\r\n//     return {\r\n//       IS_PERMISSION_ALLOWED: false,\r\n//       LATITUDE: \"\",\r\n//       LONGITUDE: \"\",\r\n//       ERROR_MESSAGE: \"Geolocation not supported in this browser\",\r\n//       ERROR_CODE: VKYCErrorCode.NOT_SUPPORTED,\r\n//     };\r\n//   }\r\n\r\n//   return new Promise((resolve) => {\r\n//     const timeout = setTimeout(() => {\r\n//       resolve({\r\n//         IS_PERMISSION_ALLOWED: false,\r\n//         LATITUDE: \"\",\r\n//         LONGITUDE: \"\",\r\n//         ERROR_MESSAGE: \"Location request timed out\",\r\n//         ERROR_CODE: VKYCErrorCode.TIMEOUT,\r\n//       });\r\n//     }, 15000);\r\n\r\n//     navigator.geolocation.getCurrentPosition(\r\n//       (pos) => {\r\n//         clearTimeout(timeout);\r\n//         resolve({\r\n//           IS_PERMISSION_ALLOWED: true,\r\n//           LATITUDE: pos.coords.latitude.toFixed(6),\r\n//           LONGITUDE: pos.coords.longitude.toFixed(6),\r\n//         });\r\n//       },\r\n//       (err) => {\r\n//         clearTimeout(timeout);\r\n//         let code = VKYCErrorCode.UNKNOWN_ERROR;\r\n//         if (err.code === 1) code = VKYCErrorCode.PERMISSION_DENIED;\r\n//         if (err.code === 2) code = VKYCErrorCode.DEVICE_NOT_FOUND;\r\n//         if (err.code === 3) code = VKYCErrorCode.TIMEOUT;\r\n\r\n//         resolve({\r\n//           IS_PERMISSION_ALLOWED: false,\r\n//           LATITUDE: \"\",\r\n//           LONGITUDE: \"\",\r\n//           ERROR_MESSAGE: err.message || \"Location access denied\",\r\n//           ERROR_CODE: code,\r\n//         });\r\n//       },\r\n//       { enableHighAccuracy: true, timeout: 15000, maximumAge: 60000 }\r\n//     );\r\n//   });\r\n// }\r\n\r\n// export async function checkNetworkStatus(options: { testDownloadSpeed?: boolean } = {}): Promise<VKYCNetworkResult> {\r\n//   const connection = (navigator as any).connection || (navigator as any).mozConnection || (navigator as any).webkitConnection;\r\n\r\n//   const result: VKYCNetworkResult = {\r\n//     IS_PERMISSION_ALLOWED: true,\r\n//     IS_ONLINE: navigator.onLine,\r\n//     DOWNLINK_MBPS: connection?.downlink ?? undefined,\r\n//     CONNECTION_TYPE: connection?.effectiveType ?? undefined,\r\n//     RTT_MS: connection?.rtt ?? undefined,\r\n//   };\r\n\r\n//   if (options.testDownloadSpeed) {\r\n//     const speed = await measureDownloadSpeed();\r\n//     result.DOWNLOAD_SPEED_MBPS = speed ?? undefined;\r\n//     if (!speed) {\r\n//       result.ERROR_MESSAGE = \"Download speed test failed\";\r\n//     }\r\n//   }\r\n\r\n//   return result;\r\n// }\r\n\r\n\r\n// async function requestMedia(constraints: MediaStreamConstraints): Promise<any> {\r\n//   if (!navigator.mediaDevices?.getUserMedia) {\r\n//     return {\r\n//       IS_PERMISSION_ALLOWED: false,\r\n//       HAS_CAMERA: false,\r\n//       HAS_MICROPHONE: false,\r\n//       ERROR_MESSAGE: \"getUserMedia not supported (use HTTPS)\",\r\n//       ERROR_CODE: VKYCErrorCode.NOT_SUPPORTED,\r\n//     };\r\n//   }\r\n\r\n//   try {\r\n//     const stream = await navigator.mediaDevices.getUserMedia(constraints);\r\n//     const videoTrack = stream.getVideoTracks()[0];\r\n//     const audioTrack = stream.getAudioTracks()[0];\r\n//     const settings = videoTrack?.getSettings();\r\n\r\n//     const result: any = {\r\n//       IS_PERMISSION_ALLOWED: true,\r\n//       HAS_CAMERA: !!videoTrack,\r\n//       HAS_MICROPHONE: !!audioTrack,\r\n//     };\r\n\r\n//     if (videoTrack) {\r\n//       result.RESOLUTION_WIDTH = settings?.width;\r\n//       result.RESOLUTION_HEIGHT = settings?.height;\r\n//     }\r\n\r\n//     // Stop tracks immediately (we only needed permission + info)\r\n//     stream.getTracks().forEach((t) => t.stop());\r\n\r\n//     return result;\r\n//   } catch (err: any) {\r\n//     let code = VKYCErrorCode.UNKNOWN_ERROR;\r\n//     if (err.name === \"NotAllowedError\" || err.name === \"PermissionDeniedError\") {\r\n//       code = VKYCErrorCode.PERMISSION_DENIED;\r\n//     } else if (err.name === \"NotFoundError\") {\r\n//       code = VKYCErrorCode.DEVICE_NOT_FOUND;\r\n//     }\r\n\r\n//     return {\r\n//       IS_PERMISSION_ALLOWED: false,\r\n//       HAS_CAMERA: false,\r\n//       HAS_MICROPHONE: false,\r\n//       ERROR_MESSAGE: err.message || \"Media access failed\",\r\n//       ERROR_CODE: code,\r\n//     };\r\n//   }\r\n// }\r\n\r\n// async function measureDownloadSpeed(): Promise<number | null> {\r\n//   const testUrl = `https://speed.cloudflare.com/__down?bytes=${10 * 1024 * 1024}`; // 10 MB\r\n//   const controller = new AbortController();\r\n//   const timeout = setTimeout(() => controller.abort(), 20000);\r\n\r\n//   try {\r\n//     const start = performance.now();\r\n//     const res = await fetch(testUrl, { signal: controller.signal, cache: \"no-store\" });\r\n//     if (!res.ok || !res.body) throw new Error(\"No body\");\r\n\r\n//     await res.body.pipeTo(new WritableStream()); \r\n//     const duration = (performance.now() - start) / 1000;\r\n//     clearTimeout(timeout);\r\n//     return Number(((10 * 8) / duration).toFixed(2)); \r\n//   } catch {\r\n//     clearTimeout(timeout);\r\n//     return null;\r\n//   }\r\n// }\r\n\r\n\r\n// export async function verifyAllPermissions(testSpeed = false) {\r\n//   const [camera, mic, location, network] = await Promise.all([\r\n//     requestCameraAccess(),\r\n//     requestMicrophoneAccess(),\r\n//     requestLocationAccess(),\r\n//     checkNetworkStatus({ testDownloadSpeed: testSpeed }),\r\n//   ]);\r\n\r\n//   return {\r\n//     camera,\r\n//     mic,\r\n//     location,\r\n//     network,\r\n//     videoAndMic: await requestVideoAndMicAccess(), // optional combined\r\n//     IS_ALL_GRANTED:\r\n//       camera.IS_PERMISSION_ALLOWED &&\r\n//       mic.IS_PERMISSION_ALLOWED &&\r\n//       location.IS_PERMISSION_ALLOWED &&\r\n//       network.IS_ONLINE,\r\n//   };\r\n// }\r\n\r\nexport enum VKYCErrorCode {\r\n  PERMISSION_DENIED = \"PERMISSION_DENIED\",\r\n  DEVICE_NOT_FOUND = \"DEVICE_NOT_FOUND\",\r\n  NOT_SUPPORTED = \"NOT_SUPPORTED\",\r\n  TIMEOUT = \"TIMEOUT\",\r\n  NETWORK_ERROR = \"NETWORK_ERROR\",\r\n  UNKNOWN_ERROR = \"UNKNOWN_ERROR\",\r\n}\r\n\r\nexport enum VKYCPermissionStatus {\r\n  ALLOWED = \"ALLOWED\",\r\n  NOT_ALLOWED = \"NOT_ALLOWED\",  // User dismissed/cancelled the prompt\r\n  BLOCKED = \"BLOCKED\"           // User explicitly blocked the permission\r\n}\r\n\r\nexport interface BaseVKYCResult {\r\n  IS_PERMISSION_ALLOWED: VKYCPermissionStatus;\r\n  ERROR_MESSAGE?: string;\r\n  ERROR_CODE?: VKYCErrorCode;\r\n}\r\n\r\n// Camera + Video + Resolution\r\nexport interface VKYCCameraResult extends BaseVKYCResult {\r\n  HAS_CAMERA: boolean;\r\n  RESOLUTION_WIDTH?: number;\r\n  RESOLUTION_HEIGHT?: number;\r\n}\r\n\r\n// Microphone\r\nexport interface VKYCMicResult extends BaseVKYCResult {\r\n  HAS_MICROPHONE: boolean;\r\n}\r\n\r\n// Geolocation\r\nexport interface VKYCLocationResult extends BaseVKYCResult {\r\n  LATITUDE: string;\r\n  LONGITUDE: string;\r\n}\r\n\r\n// Network + Speed\r\nexport interface VKYCNetworkResult extends BaseVKYCResult {\r\n  IS_ONLINE: boolean;\r\n  DOWNLINK_MBPS?: number;          \r\n  CONNECTION_TYPE?: string;\r\n  RTT_MS?: number;\r\n  DOWNLOAD_SPEED_MBPS?: number;    \r\n}\r\n\r\nexport async function requestCameraAccess(): Promise<VKYCCameraResult> {\r\n  return requestMedia({ video: true, audio: false }, 'camera');\r\n}\r\n\r\nexport async function requestMicrophoneAccess(): Promise<VKYCMicResult> {\r\n  return requestMedia({ video: false, audio: true }, 'microphone');\r\n}\r\n\r\nexport async function requestVideoAndMicAccess(): Promise<VKYCCameraResult & VKYCMicResult> {\r\n  return requestMedia({ video: true, audio: true }, 'camera-microphone');\r\n}\r\n\r\nexport async function requestLocationAccess(): Promise<VKYCLocationResult> {\r\n  if (!navigator.geolocation) {\r\n    return {\r\n      IS_PERMISSION_ALLOWED: VKYCPermissionStatus.NOT_ALLOWED,\r\n      LATITUDE: \"\",\r\n      LONGITUDE: \"\",\r\n      ERROR_MESSAGE: \"Geolocation not supported in this browser\",\r\n      ERROR_CODE: VKYCErrorCode.NOT_SUPPORTED,\r\n    };\r\n  }\r\n\r\n  return new Promise(async (resolve) => {\r\n    // Check permission state first using Permissions API if available\r\n    let isPermissionBlocked = false;\r\n    \r\n    if (navigator.permissions) {\r\n      try {\r\n        const permission = await navigator.permissions.query({ name: 'geolocation' as PermissionName });\r\n        if (permission.state === 'denied') {\r\n          isPermissionBlocked = true;\r\n          resolve({\r\n            IS_PERMISSION_ALLOWED: VKYCPermissionStatus.BLOCKED,\r\n            LATITUDE: \"\",\r\n            LONGITUDE: \"\",\r\n            ERROR_MESSAGE: \"Location permission is permanently blocked\",\r\n            ERROR_CODE: VKYCErrorCode.PERMISSION_DENIED,\r\n          });\r\n          return;\r\n        }\r\n      } catch (error) {\r\n        // Permissions API failed, continue with regular flow\r\n        console.warn('Permissions API not available:', error);\r\n      }\r\n    }\r\n\r\n    const timeout = setTimeout(() => {\r\n      resolve({\r\n        IS_PERMISSION_ALLOWED: VKYCPermissionStatus.NOT_ALLOWED,\r\n        LATITUDE: \"\",\r\n        LONGITUDE: \"\",\r\n        ERROR_MESSAGE: \"Location request timed out\",\r\n        ERROR_CODE: VKYCErrorCode.TIMEOUT,\r\n      });\r\n    }, 15000);\r\n\r\n    navigator.geolocation.getCurrentPosition(\r\n      (pos) => {\r\n        clearTimeout(timeout);\r\n        resolve({\r\n          IS_PERMISSION_ALLOWED: VKYCPermissionStatus.ALLOWED,\r\n          LATITUDE: pos.coords.latitude.toFixed(6),\r\n          LONGITUDE: pos.coords.longitude.toFixed(6),\r\n        });\r\n      },\r\n      async (err) => {\r\n        clearTimeout(timeout);\r\n        \r\n        let permissionStatus: VKYCPermissionStatus;\r\n        let errorCode = VKYCErrorCode.UNKNOWN_ERROR;\r\n        let errorMessage = err.message || \"Location access denied\";\r\n\r\n        if (err.code === 1) {\r\n          errorCode = VKYCErrorCode.PERMISSION_DENIED;\r\n          \r\n          // Check if permission is blocked using Permissions API\r\n          if (navigator.permissions) {\r\n            try {\r\n              const permission = await navigator.permissions.query({ name: 'geolocation' as PermissionName });\r\n              if (permission.state === 'denied') {\r\n                permissionStatus = VKYCPermissionStatus.BLOCKED;\r\n                errorMessage = \"Location permission is permanently blocked\";\r\n              } else {\r\n                permissionStatus = VKYCPermissionStatus.NOT_ALLOWED;\r\n                errorMessage = \"Location permission was denied or dismissed\";\r\n              }\r\n            } catch {\r\n              // If Permissions API fails, we can't determine if it's blocked\r\n              permissionStatus = VKYCPermissionStatus.NOT_ALLOWED;\r\n            }\r\n          } else {\r\n            // No Permissions API, we can't distinguish between blocked and dismissed\r\n            permissionStatus = VKYCPermissionStatus.NOT_ALLOWED;\r\n          }\r\n        } else if (err.code === 2) {\r\n          errorCode = VKYCErrorCode.DEVICE_NOT_FOUND;\r\n          permissionStatus = VKYCPermissionStatus.NOT_ALLOWED;\r\n        } else if (err.code === 3) {\r\n          errorCode = VKYCErrorCode.TIMEOUT;\r\n          permissionStatus = VKYCPermissionStatus.NOT_ALLOWED;\r\n        } else {\r\n          permissionStatus = VKYCPermissionStatus.NOT_ALLOWED;\r\n        }\r\n\r\n        resolve({\r\n          IS_PERMISSION_ALLOWED: permissionStatus!,\r\n          LATITUDE: \"\",\r\n          LONGITUDE: \"\",\r\n          ERROR_MESSAGE: errorMessage,\r\n          ERROR_CODE: errorCode,\r\n        });\r\n      },\r\n      { enableHighAccuracy: true, timeout: 15000, maximumAge: 60000 }\r\n    );\r\n  });\r\n}\r\n\r\nexport async function checkNetworkStatus(options: { testDownloadSpeed?: boolean } = {}): Promise<VKYCNetworkResult> {\r\n  const connection = (navigator as any).connection || (navigator as any).mozConnection || (navigator as any).webkitConnection;\r\n\r\n  const result: VKYCNetworkResult = {\r\n    IS_PERMISSION_ALLOWED: VKYCPermissionStatus.ALLOWED, // Network check doesn't require permission\r\n    IS_ONLINE: navigator.onLine,\r\n    DOWNLINK_MBPS: connection?.downlink ?? undefined,\r\n    CONNECTION_TYPE: connection?.effectiveType ?? undefined,\r\n    RTT_MS: connection?.rtt ?? undefined,\r\n  };\r\n\r\n  if (options.testDownloadSpeed) {\r\n    const speed = await measureDownloadSpeed();\r\n    result.DOWNLOAD_SPEED_MBPS = speed ?? undefined;\r\n    if (!speed) {\r\n      result.ERROR_MESSAGE = \"Download speed test failed\";\r\n      result.ERROR_CODE = VKYCErrorCode.NETWORK_ERROR;\r\n    }\r\n  }\r\n\r\n  return result;\r\n}\r\n\r\nasync function requestMedia(\r\n  constraints: MediaStreamConstraints, \r\n  permissionType: 'camera' | 'microphone' | 'camera-microphone'\r\n): Promise<any> {\r\n  if (!navigator.mediaDevices?.getUserMedia) {\r\n    return {\r\n      IS_PERMISSION_ALLOWED: VKYCPermissionStatus.NOT_ALLOWED,\r\n      HAS_CAMERA: false,\r\n      HAS_MICROPHONE: false,\r\n      ERROR_MESSAGE: \"getUserMedia not supported (use HTTPS)\",\r\n      ERROR_CODE: VKYCErrorCode.NOT_SUPPORTED,\r\n    };\r\n  }\r\n\r\n  // Check current permission state first\r\n  let isPermissionBlocked = false;\r\n  \r\n  if (navigator.permissions) {\r\n    try {\r\n      if (permissionType === 'camera') {\r\n        const permission = await navigator.permissions.query({ name: 'camera' as PermissionName });\r\n        if (permission.state === 'denied') {\r\n          isPermissionBlocked = true;\r\n        }\r\n      } else if (permissionType === 'microphone') {\r\n        const permission = await navigator.permissions.query({ name: 'microphone' as PermissionName });\r\n        if (permission.state === 'denied') {\r\n          isPermissionBlocked = true;\r\n        }\r\n      } else if (permissionType === 'camera-microphone') {\r\n        const [cameraPerm, micPerm] = await Promise.all([\r\n          navigator.permissions.query({ name: 'camera' as PermissionName }),\r\n          navigator.permissions.query({ name: 'microphone' as PermissionName })\r\n        ]);\r\n        if (cameraPerm.state === 'denied' || micPerm.state === 'denied') {\r\n          isPermissionBlocked = true;\r\n        }\r\n      }\r\n      \r\n      if (isPermissionBlocked) {\r\n        return {\r\n          IS_PERMISSION_ALLOWED: VKYCPermissionStatus.BLOCKED,\r\n          HAS_CAMERA: false,\r\n          HAS_MICROPHONE: false,\r\n          ERROR_MESSAGE: \"Media permissions are permanently blocked\",\r\n          ERROR_CODE: VKYCErrorCode.PERMISSION_DENIED,\r\n        };\r\n      }\r\n    } catch (error) {\r\n      // Permissions API not available or failed, continue with request\r\n      console.warn('Permissions API not available:', error);\r\n    }\r\n  }\r\n\r\n  try {\r\n    const stream = await navigator.mediaDevices.getUserMedia(constraints);\r\n    const videoTrack = stream.getVideoTracks()[0];\r\n    const audioTrack = stream.getAudioTracks()[0];\r\n    const settings = videoTrack?.getSettings();\r\n\r\n    const result: any = {\r\n      IS_PERMISSION_ALLOWED: VKYCPermissionStatus.ALLOWED,\r\n      HAS_CAMERA: !!videoTrack,\r\n      HAS_MICROPHONE: !!audioTrack,\r\n    };\r\n\r\n    if (videoTrack) {\r\n      result.RESOLUTION_WIDTH = settings?.width;\r\n      result.RESOLUTION_HEIGHT = settings?.height;\r\n    }\r\n\r\n    // Stop tracks immediately (we only needed permission + info)\r\n    stream.getTracks().forEach((t) => t.stop());\r\n\r\n    return result;\r\n  } catch (err: any) {\r\n    let permissionStatus: VKYCPermissionStatus;\r\n    let errorCode = VKYCErrorCode.UNKNOWN_ERROR;\r\n    let errorMessage = err.message || \"Media access failed\";\r\n\r\n    if (err.name === \"NotAllowedError\" || err.name === \"PermissionDeniedError\") {\r\n      errorCode = VKYCErrorCode.PERMISSION_DENIED;\r\n      \r\n      // Check current permission state to determine if it's blocked\r\n      if (navigator.permissions) {\r\n        try {\r\n          let isNowBlocked = false;\r\n          \r\n          if (permissionType === 'camera') {\r\n            const permission = await navigator.permissions.query({ name: 'camera' as PermissionName });\r\n            isNowBlocked = permission.state === 'denied';\r\n          } else if (permissionType === 'microphone') {\r\n            const permission = await navigator.permissions.query({ name: 'microphone' as PermissionName });\r\n            isNowBlocked = permission.state === 'denied';\r\n          } else if (permissionType === 'camera-microphone') {\r\n            const [cameraPerm, micPerm] = await Promise.all([\r\n              navigator.permissions.query({ name: 'camera' as PermissionName }),\r\n              navigator.permissions.query({ name: 'microphone' as PermissionName })\r\n            ]);\r\n            isNowBlocked = cameraPerm.state === 'denied' || micPerm.state === 'denied';\r\n          }\r\n          \r\n          if (isNowBlocked) {\r\n            permissionStatus = VKYCPermissionStatus.BLOCKED;\r\n            errorMessage = \"Media permission is permanently blocked\";\r\n          } else {\r\n            permissionStatus = VKYCPermissionStatus.NOT_ALLOWED;\r\n            errorMessage = \"Permission prompt was dismissed\";\r\n          }\r\n        } catch {\r\n          // If Permissions API fails, we can't determine if it's blocked\r\n          permissionStatus = VKYCPermissionStatus.NOT_ALLOWED;\r\n          errorMessage = \"Permission was denied\";\r\n        }\r\n      } else {\r\n        // No Permissions API, we can't distinguish between blocked and dismissed\r\n        permissionStatus = VKYCPermissionStatus.NOT_ALLOWED;\r\n        errorMessage = \"Permission was denied\";\r\n      }\r\n    } else if (err.name === \"NotFoundError\") {\r\n      errorCode = VKYCErrorCode.DEVICE_NOT_FOUND;\r\n      permissionStatus = VKYCPermissionStatus.NOT_ALLOWED;\r\n    } else {\r\n      permissionStatus = VKYCPermissionStatus.NOT_ALLOWED;\r\n    }\r\n\r\n    return {\r\n      IS_PERMISSION_ALLOWED: permissionStatus,\r\n      HAS_CAMERA: false,\r\n      HAS_MICROPHONE: false,\r\n      ERROR_MESSAGE: errorMessage,\r\n      ERROR_CODE: errorCode,\r\n    };\r\n  }\r\n}\r\n\r\nasync function measureDownloadSpeed(): Promise<number | null> {\r\n  const testUrl = `https://speed.cloudflare.com/__down?bytes=${10 * 1024 * 1024}`; // 10 MB\r\n  const controller = new AbortController();\r\n  const timeout = setTimeout(() => controller.abort(), 20000);\r\n\r\n  try {\r\n    const start = performance.now();\r\n    const res = await fetch(testUrl, { signal: controller.signal, cache: \"no-store\" });\r\n    if (!res.ok || !res.body) throw new Error(\"No body\");\r\n\r\n    await res.body.pipeTo(new WritableStream()); \r\n    const duration = (performance.now() - start) / 1000;\r\n    clearTimeout(timeout);\r\n    return Number(((10 * 8) / duration).toFixed(2)); \r\n  } catch {\r\n    clearTimeout(timeout);\r\n    return null;\r\n  }\r\n}\r\n\r\nexport async function verifyAllPermissions(testSpeed = false) {\r\n  const [camera, mic, location, network] = await Promise.all([\r\n    requestCameraAccess(),\r\n    requestMicrophoneAccess(),\r\n    requestLocationAccess(),\r\n    checkNetworkStatus({ testDownloadSpeed: testSpeed }),\r\n  ]);\r\n\r\n  return {\r\n    camera,\r\n    mic,\r\n    location,\r\n    network,\r\n    videoAndMic: await requestVideoAndMicAccess(),\r\n    IS_ALL_GRANTED:\r\n      camera.IS_PERMISSION_ALLOWED === VKYCPermissionStatus.ALLOWED &&\r\n      mic.IS_PERMISSION_ALLOWED === VKYCPermissionStatus.ALLOWED &&\r\n      location.IS_PERMISSION_ALLOWED === VKYCPermissionStatus.ALLOWED &&\r\n      network.IS_ONLINE,\r\n  };\r\n}\r\n\r\n// Utility function to get human-readable permission status\r\nexport function getPermissionStatusDescription(status: VKYCPermissionStatus): string {\r\n  switch (status) {\r\n    case VKYCPermissionStatus.ALLOWED:\r\n      return \"Permission granted by user\";\r\n    case VKYCPermissionStatus.NOT_ALLOWED:\r\n      return \"Permission not granted (user dismissed or cancelled the prompt)\";\r\n    case VKYCPermissionStatus.BLOCKED:\r\n      return \"Permission permanently blocked by user\";\r\n    default:\r\n      return \"Unknown permission status\";\r\n  }\r\n}"],"mappings":"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","names":["VKYCErrorCode","VKYCPermissionStatus"]}